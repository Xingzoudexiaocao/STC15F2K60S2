C51 COMPILER V9.00   LCD12864                                                              10/19/2019 19:28:37 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN LCD12864.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE LCD12864.c COMPACT BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          #include"LCD12864.h"
   3          
   4          /************************************************************
   5          功能描述：1ms延时函数
   6          入口参数：uint x
   7          出口参数：无
   8          ************************************************************/
   9          void delay_1ms(unsigned int x)
  10          {
  11   1              unsigned int i,j;
  12   1              for(j=0;j<x;j++)
  13   1              for(i=0;i<110;i++);
  14   1      }
  15          
  16          
  17          /************************************************************
  18          功能描述:判断12864是否忙
  19          入口参数：无
  20          出口参数：无
  21          ************************************************************/
  22          void lcd_busy(void)
  23          {
  24   1        LCD_data=0xff;
  25   1        LCD_RW=1;
  26   1        LCD_RS=0;
  27   1        LCD_EN=1;
  28   1        while(LCD_data&0x80);
  29   1        LCD_EN=0;
  30   1      }
  31          
  32          /************************************************************
  33          功能描述：根据12864的操作时序写指令数据到LCD12864
  34          入口参数：cmd 写入的指令数据
  35          出口参数：无
  36          ************************************************************/
  37          void write_cmd(unsigned char cmd)  //cmd为指令
  38          {
  39   1              lcd_busy();
  40   1              LCD_data=cmd;   //cmd就是指令数据，如cmd=0x0c，那么就是显示开，关光标
  41   1              LCD_RW=0;                  
  42   1              LCD_RS=0;
  43   1              LCD_EN=1;
  44   1              _nop_();
  45   1              LCD_EN=0;
  46   1      }
  47          
  48          /************************************************************
  49          功能描述：根据12864的操作时序得，写显示数据到12864
  50          入口参数：dat 写入的数据
  51          出口参数：无
  52          ************************************************************/
  53          void write_dat(unsigned char dat)      //dat为数据
  54          {
  55   1              lcd_busy();
C51 COMPILER V9.00   LCD12864                                                              10/19/2019 19:28:37 PAGE 2   

  56   1              LCD_data=dat;  //根据时序得，使能信号相对于RS，RW要稍微延时5ms，这是准备数据
  57   1              LCD_RW=0;
  58   1              LCD_RS=1;
  59   1              LCD_EN=1;
  60   1              _nop_();
  61   1              LCD_EN=0;
  62   1      }
  63          
  64          /************************************************************
  65          功能描述：设定显示位置
  66          入口参数：X,Y这里的X将要是第一个汉字的坐标，Y值是向右移动的汉字个数
  67          出口参数：无
  68          *************************************************************/
  69          void lcd_pos(unsigned char X,unsigned char Y)
  70          {       unsigned char pos;
  71   1              if(X==0)
  72   1                      {X=0x80;}       //根据汉字显示坐标而得，0x80为第一行第一个汉字的位置
  73   1              else if(X==1)
  74   1                      {X=0x90;}       //根据汉字显示坐标而得，0x90为第二行第一个汉字的位置
  75   1              else if(X==2)
  76   1                      {X=0x88;}       //根据汉字显示坐标而得，0x88为第三行第一个汉字的位置
  77   1              else if(X==3)
  78   1                      {X=0x98;}       //根据汉字显示坐标而得，0x98为第四行第一个汉字的位置
  79   1              pos=X+Y;                //pos为写入LCD指令数据，
  80   1                                          //如X=0x80（第一行第一个汉字的位置），Y=2（右移个数），
  81   1                          // pos=X+Y=0x80+2=0x82（即第一行第三个汉字的位置）//
  82   1              write_cmd(pos); //写入指令到LCD函数
  83   1      } 
  84          
  85          /************************************************************
  86          功能描述：写字符串到LCD12864
  87          入口参数：c 待写入字符串的首地址
  88          出口参数：无
  89          ************************************************************/
  90          void write_str(unsigned char *c)
  91          {
  92   1              while(*c!=0)
  93   1              {
  94   2               write_dat(*c);
  95   2              c++;
  96   2              }
  97   1      }
  98          
  99          /************************************************************
 100          功能描述：LCD初始化的设定
 101          入口参数：无
 102          出口参数：无
 103          ************************************************************/
 104          void lcd_init()
 105          {
 106   1              write_cmd(0x30);        //基本指令操作
 107   1              delay_1ms(5);
 108   1              write_cmd(0x0c);        //显示开，关光标
 109   1              delay_1ms(5);
 110   1              write_cmd(0x01);        //清除LCD的显示内容
 111   1              delay_1ms(5);
 112   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    165    ----
   CONSTANT SIZE    =   ----    ----
C51 COMPILER V9.00   LCD12864                                                              10/19/2019 19:28:37 PAGE 3   

   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
