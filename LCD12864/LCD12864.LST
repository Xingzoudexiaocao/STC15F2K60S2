C51 COMPILER V9.00   LCD12864                                                              04/22/2019 12:09:09 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LCD12864
OBJECT MODULE PLACED IN LCD12864.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE LCD12864.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include"stc15fxxxx.h"
   2          #include<stdlib.h>
   3          /*************************端口定义***************************/
   4          #define LCD_data P0    //数据端口
   5          sbit LCD_RS=P2^0; //液晶寄存器选择输入
   6          sbit LCD_RW=P2^1; //液晶读写控制
   7          sbit LCD_EN=P2^2; //液晶使能控制端
   8          /************************************************************
   9          功能描述：1ms延时函数
  10          入口参数：uint x
  11          出口参数：无
  12          ************************************************************/
  13          void delay_1ms(u16 x)
  14          {
  15   1              u16 i,j;
  16   1              for(j=0;j<x;j++)
  17   1              for(i=0;i<110;i++);
  18   1      }
  19          
  20          
  21          /************************************************************
  22          功能描述:判断12864是否忙
  23          入口参数：无
  24          出口参数：无
  25          ************************************************************/
  26          void lcd_busy(void)
  27          {
  28   1        LCD_data=0xff;
  29   1        LCD_RW=1;
  30   1        LCD_RS=0;
  31   1        LCD_EN=1;
  32   1        while(LCD_data&0x80);
  33   1        LCD_EN=0;
  34   1      }
  35          
  36          /************************************************************
  37          功能描述：根据12864的操作时序写指令数据到LCD12864
  38          入口参数：cmd 写入的指令数据
  39          出口参数：无
  40          ************************************************************/
  41          void write_cmd(u8 cmd)  //cmd为指令
  42          {
  43   1              lcd_busy();
  44   1              LCD_data=cmd;   //cmd就是指令数据，如cmd=0x0c，那么就是显示开，关光标
  45   1              LCD_RW=0;                  
  46   1              LCD_RS=0;
  47   1              LCD_EN=1;
  48   1              _nop_();
  49   1              LCD_EN=0;
  50   1      }
  51          
  52          /************************************************************
  53          功能描述：根据12864的操作时序得，写显示数据到12864
  54          入口参数：dat 写入的数据
  55          出口参数：无
C51 COMPILER V9.00   LCD12864                                                              04/22/2019 12:09:09 PAGE 2   

  56          ************************************************************/
  57          void write_dat(u8 dat)      //dat为数据
  58          {
  59   1              lcd_busy();
  60   1              LCD_data=dat;  //根据时序得，使能信号相对于RS，RW要稍微延时5ms，这是准备数据
  61   1              LCD_RW=0;
  62   1              LCD_RS=1;
  63   1              LCD_EN=1;
  64   1              _nop_();
  65   1              LCD_EN=0;
  66   1      }
  67          
  68          /************************************************************
  69          功能描述：设定显示位置
  70          入口参数：X,Y这里的X将要是第一个汉字的坐标，Y值是向右移动的汉字个数
  71          出口参数：无
  72          *************************************************************/
  73          void lcd_pos(u8 X,u8 Y)
  74          {       u8 pos;
  75   1              if(X==0)
  76   1                      {X=0x80;}       //根据汉字显示坐标而得，0x80为第一行第一个汉字的位置
  77   1              else if(X==1)
  78   1                      {X=0x90;}       //根据汉字显示坐标而得，0x90为第二行第一个汉字的位置
  79   1              else if(X==2)
  80   1                      {X=0x88;}       //根据汉字显示坐标而得，0x88为第三行第一个汉字的位置
  81   1              else if(X==3)
  82   1                      {X=0x98;}       //根据汉字显示坐标而得，0x98为第四行第一个汉字的位置
  83   1              pos=X+Y;                //pos为写入LCD指令数据，
  84   1                                          //如X=0x80（第一行第一个汉字的位置），Y=2（右移个数），
  85   1                          // pos=X+Y=0x80+2=0x82（即第一行第三个汉字的位置）//
  86   1              write_cmd(pos); //写入指令到LCD函数
  87   1      } 
  88          
  89          /************************************************************
  90          功能描述：写字符串到LCD12864
  91          入口参数：c 待写入字符串的首地址
  92          出口参数：无
  93          ************************************************************/
  94          void write_str(u8 *c)
  95          {
  96   1              while(*c!=0)
  97   1              {
  98   2               write_dat(*c);
  99   2              c++;
 100   2              }
 101   1      }
 102          
 103          /************************************************************
 104          功能描述：LCD初始化的设定
 105          入口参数：无
 106          出口参数：无
 107          ************************************************************/
 108          void lcd_init()
 109          {
 110   1              write_cmd(0x30);        //基本指令操作
 111   1              delay_1ms(5);
 112   1              write_cmd(0x0c);        //显示开，关光标
 113   1              delay_1ms(5);
 114   1              write_cmd(0x01);        //清除LCD的显示内容
 115   1              delay_1ms(5);
 116   1      }

C51 COMPILER V9.00   LCD12864                                                              04/22/2019 12:09:09 PAGE 3   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    162    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
